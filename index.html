<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script>
      function myInitCode() {
        const overlayDiv = document.createElement("div");
        overlayDiv.style.cssText =
          "position:fixed; width:100%; height:100%; top: 0; left: 0; z-index:100; background-color: rgba(0,0,0,.8);";
        overlayDiv.setAttribute("id", "overlay");

        const wrapperDiv = document.createElement("div");
        wrapperDiv.style.cssText =
          "position:relative; width:100%; height:100%; z-index:500;";

        const elemIFrame = document.createElement("iFrame");
        elemIFrame.style.cssText =
          "position:absolute; width:50%; height:75%; top: 50%; left: 50%; opacity:1; z-index:1000; background:#fff; margin: auto; transform: translate(-50%,-50%)";

        elemIFrame.setAttribute("id", "blogChargeIFrame");

        wrapperDiv.appendChild(elemIFrame);
        overlayDiv.appendChild(wrapperDiv);

        let userEmail = "";
        const value = `; ${document.cookie}`;
        const parts = value.split(`; blogChargeEmail=`);
        if (parts.length === 2) {
          userEmail = parts.pop().split(";").shift();
        }

        fetch("/api/articleCheck", {
          method: "POST",
          mode: "cors",
          body: JSON.stringify({
            url: window.location.href,
            email: userEmail,
          }),
        })
          .then((response) => response.json())
          .then((data) => {
            document.body.appendChild(overlayDiv);
            document.getElementById("blogChargeIFrame").srcdoc = data.html;
            document.getElementById("blogChargeIFrame").style.height = `${
              document.getElementById("blogChargeIFrame").contentWindow.document
                .body.scrollHeight
            }px`;
            /*
      if (data.status === "ok") {
        switch (data.do) {
          case "registered":
            document.getElementById("blogChargeIFrame").src = data.html;
            document.body.appendChild(overlayDiv);
            break;
          case "pre-register":
            document.getElementById("blogChargeIFrame").src = data.html;
            document.body.appendChild(overlayDiv);
            break;
          case "continue":
            break;
          default:
            break;
        }
      }
      */
          })

          .catch(() => {
            // eslint-disable-next-line no-console
          });
      }

      if (document.readyState !== "loading") {
        myInitCode();
      } else {
        document.addEventListener("DOMContentLoaded", () => {
          myInitCode();
        });
      }
    </script>
  </head>
  <body></body>
</html>
